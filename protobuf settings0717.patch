From 89e149a4972da3324db456f2decbad599d3a1a7c Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?=E1=84=8B=E1=85=B5=E1=84=89=E1=85=B3=E1=86=BC=E1=84=8C?=
 =?UTF-8?q?=E1=85=AE?= <135289555+seungjoo-1ee@users.noreply.github.com>
Date: Wed, 17 Jul 2024 18:07:13 +0900
Subject: [PATCH] feat: protobuf settings

---
 build.gradle.kts                               | 18 +++++++++++++++++-
 common/src/main/kotlin/Main.kt                 |  3 +++
 .../kotlin/com/example/sketch/sketch/Sketch.kt | 10 ++++++++++
 src/main/proto/test.proto                      |  8 ++++++++
 4 files changed, 38 insertions(+), 1 deletion(-)
 create mode 100644 common/src/main/kotlin/Main.kt
 create mode 100644 src/main/proto/test.proto

diff --git a/build.gradle.kts b/build.gradle.kts
index 5ef9586..53fbb31 100644
--- a/build.gradle.kts
+++ b/build.gradle.kts
@@ -4,6 +4,7 @@ plugins {
     kotlin("jvm") version "1.8.0"
     kotlin("plugin.spring") version "1.8.0"
     kotlin("plugin.jpa") version "1.8.0"
+    id("com.google.protobuf") version "0.9.4"
 }
 
 group = "com.example"
@@ -76,9 +77,24 @@ dependencies {
     implementation("org.springframework.boot:spring-boot-starter-cache")
     // coroutine for test
     testImplementation("org.jetbrains.kotlinx:kotlinx-coroutines-test")
+    // protobuf
+    implementation("com.google.protobuf:protobuf-kotlin:3.25.2")
+    implementation("com.google.protobuf:protobuf-java:3.25.2")
 
-}
 
+}
+protobuf {
+    protoc {
+        artifact = "com.google.protobuf:protoc:3.25.2" // 최신 protobuf 컴파일러 버전으로 교체
+    }
+    generateProtoTasks {
+        all().forEach { task ->
+            task.builtins {
+                create("kotlin")
+            }
+        }
+    }
+}
 kotlin {
     jvmToolchain(17)
 }
diff --git a/common/src/main/kotlin/Main.kt b/common/src/main/kotlin/Main.kt
new file mode 100644
index 0000000..a7a5e00
--- /dev/null
+++ b/common/src/main/kotlin/Main.kt
@@ -0,0 +1,3 @@
+fun main() {
+    println("Hello World!")
+}
\ No newline at end of file
diff --git a/src/main/kotlin/com/example/sketch/sketch/Sketch.kt b/src/main/kotlin/com/example/sketch/sketch/Sketch.kt
index cb4e863..eb188dd 100644
--- a/src/main/kotlin/com/example/sketch/sketch/Sketch.kt
+++ b/src/main/kotlin/com/example/sketch/sketch/Sketch.kt
@@ -1,5 +1,8 @@
 package com.example.sketch.sketch
 
+import com.example.sketch.proto.ProductTagsKt
+import com.example.sketch.proto.Test
+import com.example.sketch.proto.Test.ProductTags
 import org.springframework.cache.annotation.Cacheable
 import org.springframework.stereotype.Service
 import org.springframework.web.bind.annotation.GetMapping
@@ -20,6 +23,13 @@ class SketchController(
     fun testCache(): String {
         return cacheTestService.testCache()
     } // TODO: move to test directory
+
+    fun protoTest() {
+        val message = Test.ProductTags.newBuilder()
+            .setProductId(4)
+            .addAllTags(listOf("abc","test"))
+            .build().toByteArray()
+    }
 }
 
 @Service
diff --git a/src/main/proto/test.proto b/src/main/proto/test.proto
new file mode 100644
index 0000000..347724d
--- /dev/null
+++ b/src/main/proto/test.proto
@@ -0,0 +1,8 @@
+syntax = "proto3";
+
+package com.example.sketch.proto;
+
+message ProductTags{
+  int64 product_id = 1;
+  repeated string tags = 2;
+}
\ No newline at end of file
-- 
2.45.2

